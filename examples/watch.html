<!DOCTYPE html>
<html>
  <head>
    <title>Example</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script type="text/javascript" src="https://explorercanvas.googlecode.com/svn/tags/m3/excanvas.compiled.js"></script>
    <![endif]-->
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.0.6/modernizr.min.js"></script>
    <script type="text/javascript" src="../lib/EaselJS/lib/easel.js"></script>
    <script type="text/javascript" src="../lib/jquery.floatinghands.js"></script>
    <script type="text/javascript">
    $(function () {
       var dayOffset = 0;
       var daily = function (timeFn) {
        var now = timeFn();
        var day = now.getDate();
        var dayAngle = 360 / 31;
        return day * dayAngle;
      };
      var hourly = function (timeFn) {
        var now = timeFn();
        var hour = now.getHours() % 12;
        return hour / 12 * 360;
      };
      var minutely = function (timeFn) {
        var now = timeFn();
        var second = now.getMinutes();
        return second / 60 * 360;
      };
      var secondly = function (timeFn) {
        var now = timeFn();
        var second = now.getSeconds();
        return second / 60 * 360;
      };
      var stop = new ($().floatinghands().Stopwatch)();
      var stopSecondly = function (timeFn) {
	var now = timeFn();
	var second = now / 1000
	return second / 60 * 360;
      }
      var watchTimeFn = function () {
	var c = new Date();
	return new Date(c.getFullYear(), c.getMonth(), c.getDay() + dayOffset);
      }
      var dateCorrect = function () {
	dayOffset -= 1;
      }
      var dpiConvert = function (dpi) {
	return function (mm) {
          var factor = 0.0393700787;
          inches = mm * factor;
          return inches * dpi;
	};
      }
      var mm = dpiConvert(96);

      $("#widget").floatinghands().attach([
        {image: "case.png", z: 10},
        {image: "date_disk.png", z: 9, x: 142, y: 213, regX: 142, regY: 213, updateFn: daily, timeFn: watchTimeFn},
        {image: "dial.png", z: 8},
        {image: "hour.png", z: 7, x: mm(37.5708333), y: mm(56.35625), regX: mm(37.5708333), regY: mm(56.35625), updateFn: hourly},
        {image: "min.png", z: 7, x: 142, y: 213, regX: 142, regY: 213, updateFn: minutely},
        {image: "sec.png", z: 7, x: 103, y: 213, regX: 103, regY: 213, updateFn: secondly},
        {image: "stop_sec.png", z: 7, x: 142, y: 213, regX: 142, regY: 213, updateFn: stopSecondly, timeFn: stop.timeFn},
       ], [
        {normal: "pusher_a_0.png", pressed: "pusher_a_1.png", hotspot: [mm(54.76875), 140, 260, 200], pushed: stop.toggleRun},
        {normal: "pusher_b_0.png", pressed: "pusher_b_1.png", hotspot: [207, 250, 260, 290], pushed: stop.toggleFreeze},
        {normal: "pusher_c_0.png", pressed: "pusher_c_1.png", hotspot: [40, 150, 80, 190], pushed: dateCorrect},
       ]);
    });
    </script>
  </head>
  <body>
    <img id="widget" width="284" height="426" src="fallback.png" />
  </body>
</html>
